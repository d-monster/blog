
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>dmonster&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="none">
<meta property="og:type" content="website">
<meta property="og:title" content="dmonster&#39;s blog">
<meta property="og:url" content="http://dmonster.top/index.html">
<meta property="og:site_name" content="dmonster&#39;s blog">
<meta property="og:description" content="none">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dmonster&#39;s blog">
<meta name="twitter:description" content="none">
  
    <link rel="alternative" href="/atom.xml" title="dmonster&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">dmonster&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Hello my world!</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/sitemap.xml">sitemap</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="dmonster.top">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main">
  
    <article id="post-zabbix搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/08/zabbix搭建/" class="article-date">
  <time datetime="2018-11-08T05:49:50.000Z" itemprop="datePublished">2018-11-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/zabbix/">zabbix</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/08/zabbix搭建/">zabbix搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <h2 id="安装php"><a href="#安装php" class="headerlink" title="安装php"></a>安装php</h2><p>yum安装了几次都有各种各样的库安装不上，所以还是老老实实到官网wget一个吧 <a href="http://www.php.net/downloads.php" target="_blank" rel="noopener">http://www.php.net/downloads.php</a> </p>
<ol>
<li><p>wget下之后解压，进入php目录，配置：</p>
<p> ./configure –prefix=/usr/local/php-5.5.0 –with-config-file-path=/usr/local/php-5.5.0/etc –with-bz2 –with-curl –enable-ftp –enable-sockets –disable-ipv6 –with-gd –with-jpeg-dir=/usr/local –with-png-dir=/usr/local –with-freetype-dir=/usr/local –enable-gd-native-ttf –with-iconv-dir=/usr/local –enable-mbstring –enable-calendar –with-gettext –with-libxml-dir=/usr/local –with-zlib –with-pdo-mysql=mysqlnd –with-mysqli=mysqlnd –with-mysql=mysqlnd –enable-dom –enable-xml –enable-fpm –with-libdir=lib64<br> make<br> make install<br>最后把php-fpm开启就可以了（端口9000）</p>
</li>
</ol>
<h2 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h2><p>不废话了</p>
<h2 id="安装nginx-apache"><a href="#安装nginx-apache" class="headerlink" title="安装nginx/apache"></a>安装nginx/apache</h2><p>只要是一个服务端中间件跑web页面就可以，我用的centos，就用自带的apache好了，直接把.php文件放到html目录下就好了</p>
<h2 id="安装zabbix"><a href="#安装zabbix" class="headerlink" title="安装zabbix"></a>安装zabbix</h2><p>这里安装的是zabbix4.0，具体的步骤官网比较全，但是比较乱，这里整理一下，推荐源码安装</p>
<h3 id="新建zabbix用户"><a href="#新建zabbix用户" class="headerlink" title="新建zabbix用户"></a>新建zabbix用户</h3><pre><code>groupadd zabbix
useradd -g zabbix zabbix
</code></pre><h2 id="下载安装zabbix"><a href="#下载安装zabbix" class="headerlink" title="下载安装zabbix"></a>下载安装zabbix</h2><p>解压后</p>
<pre><code>./configure --enable-server --enable-agent --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2
make install
zabbix_server //启动zabbix
</code></pre><h2 id="导入数据库"><a href="#导入数据库" class="headerlink" title="导入数据库"></a>导入数据库</h2><p>因为zabbix需要一个数据库来存放抓取到的监控数据所以需要导入zabbix的给你创建好的一个数据库</p>
<pre><code>mysql&gt; create database zabbix character set utf8 collate utf8_bin;
mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &apos;&lt;password&gt;&apos;;
cd database/mysql
mysql -uzabbix -p&lt;password&gt; zabbix &lt; schema.sql
//官方文档里写了，如果你只是要创建zabbix proxy的数据库，那么就不需要下面两个表了
mysql -uzabbix -p&lt;password&gt; zabbix &lt; images.sql
mysql -uzabbix -p&lt;password&gt; zabbix &lt; data.sql
</code></pre><h2 id="导入web页面"><a href="#导入web页面" class="headerlink" title="导入web页面"></a>导入web页面</h2><p>用apache的话很简单，只要把php文件cp到html目录下即可</p>
<pre><code>centos：
mkdir /var/www/html/zabbix
cd 源码目录下/frontends/php
cp -a . /var/www/html/zabbix
</code></pre><h2 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h2><p>这时候你至少要有3的重要的端口是监听的</p>
<ol>
<li>9000 php</li>
<li>80 web</li>
<li>3306 mysql</li>
</ol>
<h2 id="配置zabbix"><a href="#配置zabbix" class="headerlink" title="配置zabbix"></a>配置zabbix</h2><p>这时候浏览器登陆你的zabbixweb页面，不出意外会出来这个sha diao 东西<br>this<br><img src="https://i.imgur.com/Bd1pb8E.png" alt=""><br><img src="D:\blog\source\_posts" alt=""><br><img src="https://i.imgur.com/zfz70O9.png" alt=""></p>
<p>按照他标红的建议参数配置/etc/php.ini文件，大概是这几个</p>
<pre><code>max_execution_time = 300 
memory_limit = 128M 
post_max_size = 16M 
upload_max_filesize = 2M 
max_input_time = 300 
date.timezone = &quot;Asia/Shanghai&quot;
</code></pre><p>然后你会发现有好多依赖库没有安装，你可以一个一个按照他需要的装上也可以</p>
<pre><code>yum install php*
</code></pre><h2 id="常见报错"><a href="#常见报错" class="headerlink" title="常见报错"></a>常见报错</h2><ol>
<li><p>安装zabbix时./configure 会出来一系列问题</p>
<ol>
<li><p>configure: error: Not found mysqlclient library</p>
<pre><code>yum -y install mysql-devel
</code></pre></li>
<li><p>onfigure: error: Invalid Net-SNMP directory - unable to find net-snmp-config</p>
<pre><code>yum -y install libcurl-devel
yum -y install net-snmp-devel
</code></pre></li>
<li><p>configure: error: LIBXML2 library not found </p>
<pre><code>yum -y install libxml2-devel
</code></pre></li>
<li><p>configure: error: unixODBC library not found</p>
<pre><code>yum -y install unixODBC-devel
</code></pre></li>
<li><p>Invalid OPENIPMI directory - unable to find ipmiif.h</p>
<pre><code>yum -y install OpenIPMI-devel
</code></pre></li>
<li><p>Curl library not found   </p>
<pre><code>yum -y install curl-devel
</code></pre></li>
<li><p>configure: error: Unable to use libevent (libevent check failed) </p>
<pre><code>yum install libevent-devel -y
</code></pre></li>
</ol>
</li>
<li><p>安装完成登陆web后显示 zabbix server is not running</p>
<p> 说明你的zabbix没有起来，思路：</p>
<ol>
<li>看10051端口（zabbix_server的端口）有没有起来</li>
<li><p>看/tmp/zabbix_server.log日志报什么错</p>
<p> 我是日志报错是显示mysql没登上，没用密码，所以找到zabbix_server.conf文件，添加一条DBPassword=password，重启就可以了</p>
</li>
</ol>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/11/08/zabbix搭建/" data-id="cjy83157h002kmktlwicbymn6" class="article-share-link" data-share="baidu" data-title="zabbix搭建">分享到</a>
      

      
        <a href="http://dmonster.top/2018/11/08/zabbix搭建/#ds-thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-事务的隔离级别及脏读，幻读" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/20/事务的隔离级别及脏读，幻读/" class="article-date">
  <time datetime="2018-09-20T01:06:45.000Z" itemprop="datePublished">2018-09-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/20/事务的隔离级别及脏读，幻读/">事务的隔离级别及脏读，幻读</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <h1 id="事务的四种隔离级别"><a href="#事务的四种隔离级别" class="headerlink" title="事务的四种隔离级别"></a>事务的四种隔离级别</h1><h2 id="Read-uncommitted"><a href="#Read-uncommitted" class="headerlink" title="Read uncommitted"></a>Read uncommitted</h2><p>读未提交，可能出现脏读</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/09/20/事务的隔离级别及脏读，幻读/" data-id="cjy83157f002imktlimr2g0sg" class="article-share-link" data-share="baidu" data-title="事务的隔离级别及脏读，幻读">分享到</a>
      

      
        <a href="http://dmonster.top/2018/09/20/事务的隔离级别及脏读，幻读/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/笔记/">笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-linux内核相关" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/10/linux内核相关/" class="article-date">
  <time datetime="2018-08-10T08:20:06.000Z" itemprop="datePublished">2018-08-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/10/linux内核相关/">linux内核相关</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <p>今天因为有个工具需3.5以上的内核版本，所以又从大佬那里偷了一手内核升级的方法，这里先写一点，以后慢慢更新，在此感谢大佬，这篇笔记署名–汤佳舜</p>
<h1 id="centos"><a href="#centos" class="headerlink" title="centos"></a>centos</h1><h2 id="yum工具升级elrepo"><a href="#yum工具升级elrepo" class="headerlink" title="yum工具升级elrepo"></a>yum工具升级elrepo</h2><pre><code>uname- r    #查看内核版本
</code></pre><ol>
<li><p>先到elrepo官网看一手教程</p>
<p> <a href="http://elrepo.org/tiki/tiki-index.php" target="_blank" rel="noopener">http://elrepo.org/tiki/tiki-index.php</a></p>
<ol>
<li><p>获取公钥</p>
<pre><code>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
</code></pre></li>
<li><p>获取rpm源</p>
<pre><code>rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm  #centos7
rpm -Uvh http://www.elrepo.org/elrepo-release-6-8.el6.elrepo.noarch.rpm   #centos6
</code></pre></li>
<li><p>安装内核</p>
<pre><code>yum --enablerepo=elrepo-kernel install kernel-ml
</code></pre></li>
</ol>
</li>
<li><p>查看安装内核并设置</p>
<pre><code>awk -F\&apos; &apos;$1==&quot;menuentry &quot; {print i++ &quot; : &quot; $2}&apos; /etc/grub2.cfg
</code></pre><p> 输出应该是这样的：<br> <img src="https://i.imgur.com/GrNkehT.png" alt=""><br> 0就是我们刚才装的</p>
</li>
<li><p>选择启动加载的内核</p>
<p> centos7：到/etc/default/grub下改GRUB_DEFAULT参数值为0或者直接</p>
<pre><code>grub2-set-default 0
</code></pre><p> centos6：到/etc/grub.conf下改default参数值为0</p>
</li>
</ol>
<h1 id="F-amp-Q"><a href="#F-amp-Q" class="headerlink" title="F&amp;Q"></a>F&amp;Q</h1><ol>
<li><p>yum安装内核的时候回显找不到package</p>
<p> 这个一般是yum源的问题，如果是云主机，比如某云就对虚机的yum源做了限制，阻止下载内核相关工具，以保护内核，只要在 /etc/yum.conf中把最后一行的限制注释掉就行了（ps：我连图都是偷来的）<br> <img src="https://i.imgur.com/nbIBzmF.png" alt=""></p>
</li>
<li><p>内核版本不是最新，或者获取不到</p>
<p> 有可能是因为我这篇文章太久了之类的，可以在获取内核版本的rpm源的时候指定源来获取—&gt;<a href="http://elrepo.reloumirrors.net/kernel/el7/x86_64/RPMS/" target="_blank" rel="noopener">http://elrepo.reloumirrors.net/kernel/el7/x86_64/RPMS/</a></p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/08/10/linux内核相关/" data-id="cjy83156a0019mktlv4pu6qw5" class="article-share-link" data-share="baidu" data-title="linux内核相关">分享到</a>
      

      
        <a href="http://dmonster.top/2018/08/10/linux内核相关/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/笔记/">笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql-binlog日志" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/07/mysql-binlog日志/" class="article-date">
  <time datetime="2018-08-07T07:43:52.000Z" itemprop="datePublished">2018-08-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/07/mysql-binlog日志/">mysql binlog日志</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <p>binlog这个东西有点烦的，但是很关键，没办法，硬着头皮搞一搞，但是它里面的道道很多，所以这篇博客可能会持续更新</p>
<h1 id="binlog日志基本配置"><a href="#binlog日志基本配置" class="headerlink" title="binlog日志基本配置"></a>binlog日志基本配置</h1><p>打开binlog：在mysql配置文件的[mysqld]里添加，记得改完要重启mysql服务</p>
<pre><code>log-bin=mysql-bin  #mysql-bin就是binlog文件的名称
</code></pre><h1 id="binlog的操作"><a href="#binlog的操作" class="headerlink" title="binlog的操作"></a>binlog的操作</h1><ol>
<li><p>查看binlog状态（其实是查看所有log的状态）</p>
<pre><code>show variables like &apos;log_%&apos;; 
</code></pre><p> <img src="https://i.imgur.com/rzrpy0a.png" alt=""></p>
</li>
<li><p>查看binlog日志列表</p>
<pre><code>show master logs;
</code></pre><p> <img src="https://i.imgur.com/1l36kwJ.png" alt=""></p>
</li>
<li><p>查看master状态，即最后(最新)一个binlog日志的编号名称，及其最后一个操作事件pos结束点(Position)值（这个在主从同步的时候会用到）</p>
<pre><code>show master status;
</code></pre><p> <img src="https://i.imgur.com/QBnS6f9.png" alt=""><br> 这个其他的暂时看不懂，position就是当前binlog日志里的最新位置</p>
</li>
<li><p>刷新log日志，自此刻开始产生一个新编号的binlog日志文件</p>
<pre><code>flush logs；
</code></pre><p>  注：每当mysqld服务重启时，会自动执行此命令，刷新binlog日志；在mysqldump备份数据时加 -F 选项也会刷新binlog日志；</p>
</li>
<li><p>重置(清空)所有binlog日志</p>
<pre><code>reset master；
</code></pre></li>
<li><p>查看binlog的方法</p>
<p> 因为binlog是二进制文件，所以vi cat之类的不方便查看</p>
<ol>
<li><p>mysqlbinlog命令</p>
<pre><code>mysqlbinlog /usr/local/mysql/data/mysql-bin.000013
</code></pre><p> 这里的输出慢慢看还是大概能看懂的，就不多说了</p>
</li>
<li><p>用sql查询</p>
<pre><code>show binlog events [IN &apos;log_name&apos;] [FROM pos] [LIMIT [offset,] row_count];
</code></pre><p> 其中</p>
<ul>
<li>IN ‘log_name’   指定要查询的binlog文件名(不指定就是第一个binlog文件)</li>
<li>FROM pos        指定从哪个pos起始点开始查起(不指定就是从整个文件首个pos点开始算)</li>
<li>LIMIT [offset,] 偏移量(不指定就是0)</li>
<li>row_count       查询总条数(不指定就是所有行)</li>
</ul>
</li>
</ol>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/08/07/mysql-binlog日志/" data-id="cjy83156c001dmktlu30s3e63" class="article-share-link" data-share="baidu" data-title="mysql binlog日志">分享到</a>
      

      
        <a href="http://dmonster.top/2018/08/07/mysql-binlog日志/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/笔记/">笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql存储引擎" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/07/mysql存储引擎/" class="article-date">
  <time datetime="2018-08-07T06:53:48.000Z" itemprop="datePublished">2018-08-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/07/mysql存储引擎/">mysql存储引擎</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <p>今天面试给问到了，平时真没怎那么注意，所以赶紧学一波，顺便记下来</p>
<h1 id="查看mysql存储引擎"><a href="#查看mysql存储引擎" class="headerlink" title="查看mysql存储引擎"></a>查看mysql存储引擎</h1><ol>
<li><p>查看当前的mysql提供什么存储引擎</p>
<pre><code>show engines;  
</code></pre><p>  <img src="https://i.imgur.com/eCczMzO.png" alt=""></p>
</li>
<li><p>查看当前的mysql默认的存储引擎</p>
<pre><code>show variables like &apos;%storage_engine%&apos;;
</code></pre><p> <img src="https://i.imgur.com/Al78hsz.png" alt=""></p>
</li>
<li><p>查看某个表用的是什么引擎</p>
<pre><code>show create table 表名;
</code></pre><p> <img src="https://i.imgur.com/MHt2fmk.png" alt=""></p>
</li>
<li><p>指定存储引擎创建表</p>
<pre><code>create table test(
xxx xxx xxx
)ENGINE=INNODB  DEFAULT CHARSET=utf8 ;
</code></pre></li>
<li><p>修改表的存储引擎</p>
<pre><code>alter table 表名 engine=innodb;
</code></pre></li>
</ol>
<h1 id="mysql中各种引擎的区别和特点"><a href="#mysql中各种引擎的区别和特点" class="headerlink" title="mysql中各种引擎的区别和特点"></a>mysql中各种引擎的区别和特点</h1><h2 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h2><p>它不支持事务，也不支持外键，尤其是访问速度快，对事务完整性没有要求。以SELECT、INSERT为主的应用基本都可以使用这个引擎来创建表。<br>每个MyISAM在磁盘上存储成3个文件，其中文件名和表名都相同，但是扩展名分别为</p>
<ul>
<li>.frm(存储表定义)</li>
<li>MYD（MYDATA，存储数据）</li>
<li>MYI（MYINDEX，存储索引）</li>
</ul>
<p>数据文件和索引文件可以放置在不同的目录，平均分配IO，获取更快的速度。</p>
<p>MyISAM通过一个标志来区分这个数据表在上次使用后是不是被正常关闭了，并且每次打开一个MyISAM数据表都会自动检查标志来进行必要的修复处理，即使是这样，MyISAM数据表还是可能会是损坏，所以可以使用CHECK TABLE语句来检查MyISAM表的健康，并用REPAIR TABLE语句修复一个损坏到MyISAM表。</p>
<p>MyISAM的表还支持3种不同的存储格式：</p>
<ul>
<li>静态(固定长度)表，默认的存储格式。静态表中的字段都是非变长字段，这样每个记录都是固定长度的，这种存储方式的优点是存储非常迅速，容易缓存，出现故障容易恢复；缺点是占用的空间通常比动态表多。</li>
<li>动态表，包含变长字段，记录不是固定长度的，这样存储的优点是占用空间较少，但是频繁到更新删除记录会产生碎片，需要定期执行OPTIMIZE TABLE语句或myisamchk -r命令来改善性能，并且出现故障的时候恢复相对比较困难。</li>
<li>压缩表，由myisamchk工具创建，占据非常小的空间，因为每条记录都是被单独压缩的，所以只有非常小的访问开支。</li>
</ul>
<h2 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h2><p>InnoDB存储引擎提供了具有提交、回滚和崩溃恢复能力的事务安全。并且是mysql中唯一支持外键的存储引擎。但是对比MyISAM的存储引擎，InnoDB写的处理效率差一些并且会占用更多的磁盘空间以保留数据和索引。</p>
<h1 id="MEMORY"><a href="#MEMORY" class="headerlink" title="MEMORY"></a>MEMORY</h1><p>memory使用存在内存中的内容来创建表。每个MEMORY表实际对应一个磁盘文件，格式是.frm。MEMORY类型的表访问非常快，因为它到数据是放在内存中的，并且默认使用HASH索引，但是一旦服务器关闭，表中的数据就会丢失，但表还会继续存在。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/08/07/mysql存储引擎/" data-id="cjy83156h001jmktlw8yq4c83" class="article-share-link" data-share="baidu" data-title="mysql存储引擎">分享到</a>
      

      
        <a href="http://dmonster.top/2018/08/07/mysql存储引擎/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/笔记/">笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nginx搭建简易的文件服务器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/06/nginx搭建简易的文件服务器/" class="article-date">
  <time datetime="2018-08-06T09:05:26.000Z" itemprop="datePublished">2018-08-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/06/nginx搭建简易的文件服务器/">nginx搭建简易的文件服务器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <p>最简单的server这样写就行了</p>
<pre><code>server {
listen 80;
server_name _;
charset utf-8;
location / {
    root /tmp/share;
    autoindex on; #自动索引目录
    autoindex_exact_size on; #显示文件大小
    autoindex_localtime on; #显示时间
    }
}
</code></pre><p>这个玩意搭起来很简单，可以当作ftp用，还蛮方便的。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/08/06/nginx搭建简易的文件服务器/" data-id="cjy83156p001rmktlqito6txp" class="article-share-link" data-share="baidu" data-title="nginx搭建简易的文件服务器">分享到</a>
      

      
        <a href="http://dmonster.top/2018/08/06/nginx搭建简易的文件服务器/#ds-thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-crontab-ssh-rsync" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/16/crontab-ssh-rsync/" class="article-date">
  <time datetime="2018-07-16T06:29:28.000Z" itemprop="datePublished">2018-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/16/crontab-ssh-rsync/">crontab+ssh+rsync</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <p>其实这就是一个备份的设置，用crontab添加定时任务，定时执行rsync执行同步任务，进阶的话，用ssh公私钥设施ssh免密连接</p>
<h1 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h1><ul>
<li>-e：编辑该用户的计时器设置；</li>
<li>-l：列出该用户的计时器设置；</li>
<li>-r：删除该用户的计时器设置；</li>
<li>-u&lt;用户名称&gt;：指定要设定计时器的用户名称。</li>
</ul>
<p>没什么好说的，就是添加定时任务，添加完了要重启，-e开启的是vim</p>
<h1 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a>rsync</h1><p>这个想想比较多，选几个常用的记一下</p>
<ul>
<li>-v, –verbose 详细模式输出。</li>
<li>-r, –recursive 对子目录以递归模式处理。</li>
<li>-p, –perms 保持文件权限。</li>
<li>-o, –owner 保持文件属主信息。</li>
<li>-g, –group 保持文件属组信息。</li>
<li>-z, –compress 对备份的文件在传输时进行压缩处理。</li>
<li>-t, –times 保持文件时间信息。</li>
<li>–delete 删除那些DST中SRC没有的文件。</li>
<li>–delete-excluded 同样删除接收端那些被该选项指定排除的文件。</li>
<li>–delete-after 传输结束以后再删除。</li>
<li>-e 连接方式</li>
</ul>
<p>然后一般做备份的话这样写就行了</p>
<pre><code>rsync -vzrtopg -e ssh 源目录 备份目录
</code></pre><p>源或者是备份是远程主机的话，root@ip:目录（只适用于ssh的连接）</p>
<p>把这句命令行写进crontab -e里， -l就能看到了，重启contabd服务发现没用，因为需要ssh密码认证。</p>
<h2 id="ssh免密连接"><a href="#ssh免密连接" class="headerlink" title="ssh免密连接"></a>ssh免密连接</h2><p>在源主机上</p>
<pre><code>ssh-keygen -t rsa
</code></pre><p>一阵回车后，会生成id_rsa  id_rsa.pub两个文件，id_rsa为私钥，id_rsa.pub为公钥</p>
<p>用find命令找到备份主机的.ssh文件，把公钥复制到.ssh目录下，cd到这个目录下</p>
<pre><code>cat id_dsa.pub &gt; authorized_keys
</code></pre><p>完成</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/07/16/crontab-ssh-rsync/" data-id="cjy831559000bmktl4ny67a7h" class="article-share-link" data-share="baidu" data-title="crontab+ssh+rsync">分享到</a>
      

      
        <a href="http://dmonster.top/2018/07/16/crontab-ssh-rsync/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/笔记/">笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ping-traceroute-mtr" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/12/ping-traceroute-mtr/" class="article-date">
  <time datetime="2018-07-12T08:59:03.000Z" itemprop="datePublished">2018-07-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/网络/">网络</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/12/ping-traceroute-mtr/">ping,traceroute,mtr</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <p>这是在实习中遇到的一个小问题，说实话，还是能学到很多东西的</p>
<p>背景是这样的：一个客户反应他们的主机网络有问题，丢包，然后，我先往主机上ping，通的，想看一下路由哪丢包，于是就mtr，结果发现最后一跳不可达，于是traceroute试一下，也不可达。</p>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h2><p>贴：当发送一个ECHO_REQUEST时，将发送时间记录在报文里，并复制到远端主机相应的ECHO_REPLY报文中。当接收到ECHO_REPLY时，通过比较当前时间与报文时间计算出耗费时间。如果没有收到符合icmp_seq的报文，则认为该报文丢失</p>
<p>ps：好吧，我也弄不懂这是啥玩意，总之就是发送一个icmp包，通过返回信息看他是通还是不通</p>
<h2 id="traceroute"><a href="#traceroute" class="headerlink" title="traceroute"></a>traceroute</h2><p>再贴：traceroute会在IP头里设置TTL，先发1，然后第一跳路由器收到后TTL-1，变0，路由器判断丢弃反馈一个ICMP time exceeded<br>traceroute收到后，知道这个路径后继续发一个TTL为2的，然后就会发现第二个路由器，<br>最终达到目的IP的路由后会选择送到一个udp高端口（30000以上，即没有这种端口号，真变态）,获取一个ICMP port unreachable的消息，来验证确认可达</p>
<p>traceroute有一个固定的时间等待响应(ICMP TTL到期消息)。如果这个时间过了，它将打印出一系列的*号表明：在这个路径上，这个设备不能在给定的时间内发出ICMP TTL到期消息的响应。然后，Traceroute给TTL记数器加1，继续进行。</p>
<h2 id="mtr"><a href="#mtr" class="headerlink" title="mtr"></a>mtr</h2><p>跟traceroute类似，只是是用icmp协议</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>比如一个IP117.50.43.183，我ping，他是通的，</p>
<p>然后traceroute：</p>
<pre><code>traceroute to 117.50.43.183 (117.50.43.183), 30 hops max, 60 byte packets
1 10.11.200.45 (10.11.200.45) 0.448 ms 0.406 ms 0.439 ms
2 107.150.96.1 (107.150.96.1) 14.262 ms 17.157 ms 17.143 ms
3 172.25.17.1 (172.25.17.1) 7.117 ms 7.419 ms 7.509 ms
4 128.14.158.37 (128.14.158.37) 7.630 ms 128.14.158.33 (128.14.158.33) 6.825 ms 6.944 ms
5 192.254.84.16 (192.254.84.16) 1.035 ms 2.046 ms 2.074 ms
6 218.30.48.241 (218.30.48.241) 1.401 ms 192.254.81.48 (192.254.81.48) 1.404 ms 0.848 ms
7 218.30.48.241 (218.30.48.241) 1.004 ms 59.43.186.217 (59.43.186.217) 8.917 ms 218.30.48.241 (218.30.48.241) 0.981 ms
8 59.43.186.213 (59.43.186.213) 8.953 ms 59.43.248.130 (59.43.248.130) 9.278 ms 59.43.248.106 (59.43.248.106) 8.482 ms
9 59.43.182.142 (59.43.182.142) 129.264 ms 128.608 ms 59.43.182.138 (59.43.182.138) 137.349 ms
10 59.43.182.138 (59.43.182.138) 137.380 ms 59.43.247.101 (59.43.247.101) 190.740 ms 59.43.246.162 (59.43.246.162) 154.466 ms
11 59.43.247.101 (59.43.247.101) 190.368 ms 59.43.246.162 (59.43.246.162) 154.076 ms 153.944 ms
12 202.97.14.213 (202.97.14.213) 189.197 ms 59.43.246.162 (59.43.246.162) 161.843 ms 153.470 ms
13 202.97.34.77 (202.97.34.77) 182.545 ms 202.97.34.73 (202.97.34.73) 163.622 ms *
14 220.181.0.30 (220.181.0.30) 160.095 ms 220.181.177.222 (220.181.177.222) 194.610 ms *
15 220.181.177.222 (220.181.177.222) 189.952 ms 220.181.0.30 (220.181.0.30) 171.656 ms 171.188 ms
16 36.110.169.194 (36.110.169.194) 165.222 ms 218.30.28.14 (218.30.28.14) 166.458 ms 36.110.169.194 (36.110.169.194) 165.041 ms
17 36.110.169.194 (36.110.169.194) 160.074 ms * 164.930 ms
18 * * *
19 * * *
20 * * *
21 * * *
22 * * *
23 * * *
24 * * *
25 * * *
26 * * *
27 * * *
28 * * *
29 * * *
30 * * *
</code></pre><p>可以看到30跳之后就不通了，抓包可知traceroute默认是使用udp协议，而默写骨干路由节点/防火墙对一些udp包的访控限制或者过滤，然后换成icmp模式(或者用tcp模式 -T)：</p>
<pre><code>traceroute -I 117.50.43.183
traceroute to 117.50.43.183 (117.50.43.183), 30 hops max, 60 byte packets
1 10.11.200.45 (10.11.200.45) 0.673 ms 0.657 ms 0.654 ms
2 107.150.96.1 (107.150.96.1) 17.214 ms 17.306 ms 17.459 ms
3 172.25.17.1 (172.25.17.1) 921.836 ms 926.200 ms 926.464 ms
4 128.14.158.37 (128.14.158.37) 10.069 ms 10.083 ms 10.083 ms
5 192.254.81.58 (192.254.81.58) 1.506 ms 1.655 ms 1.792 ms
6 192.254.81.48 (192.254.81.48) 1.292 ms 0.905 ms 1.097 ms
7 218.30.48.241 (218.30.48.241) 1.134 ms 1.296 ms 1.293 ms
8 59.43.248.130 (59.43.248.130) 9.160 ms 9.173 ms 8.984 ms
9 59.43.189.17 (59.43.189.17) 8.747 ms 8.735 ms 8.656 ms
10 59.43.182.142 (59.43.182.142) 129.364 ms 129.340 ms 129.329 ms
11 59.43.247.101 (59.43.247.101) 179.181 ms 179.138 ms 179.172 ms
12 59.43.246.158 (59.43.246.158) 181.041 ms 181.076 ms 181.067 ms
13 * * *
14 202.97.34.73 (202.97.34.73) 154.926 ms 155.297 ms 155.444 ms
15 * * *
16 220.181.0.30 (220.181.0.30) 161.878 ms 162.084 ms 179.252 ms
17 36.110.169.194 (36.110.169.194) 165.605 ms 157.566 ms 157.244 ms
18 * * *
19 * * *
20 * * *
21 * * *
22 * * *
23 * * *
24 * * *
25 * * *
26 * * *
27 117.50.43.183 (117.50.43.183) 156.832 ms 156.803 ms 156.823 ms
28 117.50.43.183 (117.50.43.183) 158.333 ms * *
29 117.50.43.183 (117.50.43.183) 164.555 ms * *
30 117.50.43.183 (117.50.43.183) 156.988 ms 157.116 ms 157.118 ms
</code></pre><p>可以看到虽然中间大量不可达，但是通过抓包得知，他的ttl还是再不断增加，所以最后还是可以通的</p>
<p>mtr<br><img src="https://i.imgur.com/B1KYpyp.png" alt=""></p>
<p>可见最后一跳迷失了，为什么呢？继续抓包，发现ttl从17跳以后就重置变回1了，所以其实mtr也是可以在不可达的情况下增加ttl但是一般只能增加5，而这个案例之间跨的运营商服务器就非常多，最终导致看起来不可达</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>最后真相大白，真的要感谢我同事大佬，太流弊了，还有就是一定要花时间研究一下抓包技术了。</p>
<h2 id="还要说两句"><a href="#还要说两句" class="headerlink" title="还要说两句"></a>还要说两句</h2><p>有traceroute udp模式不可达引发的思考：</p>
<p>首先，我们来了解一下对于节点来说一个udp包过来会发生什么情况：</p>
<p>当一个端口&gt;32768(理论来说tcp和udp都允许0-65535的端口，但是事实上没有主机会接受这么高的端口)的udp包到达服务器时，服务器会查看监听信息，发现并没有监听这个udp端口，于是返回两个icmp包，即 ICMP TTL-expired (type 11)（这个是利用ttl的性质返回的，所有类型的traceroute都会返回这个包）和ICMP port unreachable (type 3， code 3) 其中的type，code就是icmp包的类型</p>
<p><img src="https://i.imgur.com/LvcZz3p.png" alt=""></p>
<p>可以看到(type 3， code 3)就是返回一个端口不可达的icmp包了，但是如果把这个类型的包在防火墙上禁掉了呢，对，没错，然后看起来目的就不可达了</p>
<p>同样的道理，中间的router也可能配置了这样的防火墙规则，另外需要知道的是，由于回送TTL-expired的信息需要CPU生成一个packet，必须打断 CPU，为保证其它工作的正常进行，cisco router每隔一秒才处理traceroute，所以可能在这些cpu根本就不允许回icmp包，或者因为cpu太忙，导致超时。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/07/12/ping-traceroute-mtr/" data-id="cjy8315710024mktl04bm06ha" class="article-share-link" data-share="baidu" data-title="ping,traceroute,mtr">分享到</a>
      

      
        <a href="http://dmonster.top/2018/07/12/ping-traceroute-mtr/#ds-thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-nginx负载均衡" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/05/nginx负载均衡/" class="article-date">
  <time datetime="2018-07-05T08:02:10.000Z" itemprop="datePublished">2018-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/05/nginx负载均衡/">nginx负载均衡</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <p>nginx配置不再多说</p>
<h1 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h1><p>直接贴配置：</p>
<pre><code>server {
    listen 80;
    server_name a.a.a.a;    //当前vhost地址
    ssl off;
    root html;
    index index.html index.htm;
    location /proxy/ {
        proxy_pass http://x.x.x.x:port/;        //server地址,注意最后加上端口和“/”
    }
    location ~ .*\.(js|css)$ {
        proxy_pass http://127.0.0.1;   //再写一条加载js和css静态文件
    }
}
</code></pre><p>如访问a.a.a.a/proxy/index.html，实际上访问的是x.x.x.x/index.html</p>
<h1 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h1><p>即在http{}加入：</p>
<pre><code>upstream name {
    server x.x.x.x:port weight=1;
    server x.x.x.x:port weight=1;
    。。。
}
</code></pre><p>weight为权重值，越大所有到的负载越高</p>
<p>然后将location{}中的的proxy_pass改成</p>
<pre><code>proxy_pass http://name/;
</code></pre><h1 id="获取客户端真实ip"><a href="#获取客户端真实ip" class="headerlink" title="获取客户端真实ip"></a>获取客户端真实ip</h1><h2 id="X-Forwarded-For"><a href="#X-Forwarded-For" class="headerlink" title="X-Forwarded-For"></a>X-Forwarded-For</h2><p>我的理解： X-Forwarded-For为请求header中需要手动添加的东西，它会按顺序记录所有配置并经过的ip</p>
<ul>
<li><p>参数设置</p>
<pre><code>proxy_set_header X-Forwarded-For *；
</code></pre><p>  其中</p>
<ul>
<li>*为 $remote_addr ：获取并添加最近的ip，</li>
<li>*为 $proxy_add_x_forwarded_for ：添加获得的请求头中所有的ip</li>
</ul>
</li>
</ul>
<p>我的理解是，如果客户端出口配置了代理（包括nginx，cdn等），并且没有设置X-Forwarded-For，那么之后的header中就不会写入客户端的地址，server就无法获取到真实地址了。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/07/05/nginx负载均衡/" data-id="cjy83156z0021mktlde60zgpr" class="article-share-link" data-share="baidu" data-title="nginx负载均衡">分享到</a>
      

      
        <a href="http://dmonster.top/2018/07/05/nginx负载均衡/#ds-thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-nginx搭建web服务器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/04/nginx搭建web服务器/" class="article-date">
  <time datetime="2018-07-04T02:40:21.000Z" itemprop="datePublished">2018-07-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/04/nginx搭建web服务器/">nginx搭建web服务器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
        <h1 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h1><h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><ol>
<li>openssl</li>
<li>nginx</li>
<li>gcc</li>
</ol>
<h2 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h2><p>yum然后就ok了，需要说的是yum安装的nginx默认主目录是 /usr/share/nginx，然后配置文件在 /etc/nginx/nginx.conf</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>vi /etc/nginx/nginx.conf</p>
<h2 id="server配置"><a href="#server配置" class="headerlink" title="server配置"></a>server配置</h2><p>不知道是我的原因还是我主机的原因，我的配置文件以开始就没有server{}参数，google了一下有人说本来就是这样，但是网上的教程都说以开始就有。。。</p>
<h3 id="http配置"><a href="#http配置" class="headerlink" title="http配置"></a>http配置</h3><pre><code># For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

#运行用户
user nginx;

#启动进程,通常设置成和cpu的数量相等
worker_processes auto;

#全局错误日志及PID文件
error_log /var/log/nginx/error.log;

pid /var/run/nginx.pid;

# Load dynamic modules. See /usr/share/nginx/README.dynamic.
include /usr/share/nginx/modules/*.conf;

#工作模式及连接数上限
events {
#单个后台worker process进程的最大并发链接数   
worker_connections  1024;
}

http {
#设定日志格式
log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;
                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;
                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;

access_log  /var/log/nginx/access.log  main;

#sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，必须设为 on,如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，以平衡磁盘与网络I/O处理速度，降低系统的uptime.
sendfile            on;
tcp_nopush          on;
tcp_nodelay         on;
#连接超时时间
keepalive_timeout   65;
types_hash_max_size 2048;

#设定mime类型,类型由mime.type文件定义
include             /etc/nginx/mime.types;
default_type        application/octet-stream;

#设定虚拟主机配置
server {
    #监听端口，http默认为80
    listen 80;
    #即访问方式，可填域名/ip/localhost等
    server_name www.abc.com;
    #是否开启ssl
    ssl off;
    #定义服务器默认网站根目录位置
    root html;
    #定义索引文件
    index index.html index.htm;
    #默认请求
    location / {
        root /etc/nginx/html/;
    }
}
# Load modular configuration files from the /etc/nginx/conf.d directory.
# See http://nginx.org/en/docs/ngx_core_module.html#include
# for more information.
include /etc/nginx/conf.d/*.conf;
}
</code></pre><h3 id="https配置"><a href="#https配置" class="headerlink" title="https配置"></a>https配置</h3><p>其他一样，server{}部分：</p>
<pre><code>server {
    #https侦听端口默认为443
    listen 443;
    server_name localhost;
    #打开ssl
    ssl on;
    root html;
    index index.html index.htm;

    #这两个为从域名申请的证书，放在etc/nginx下
    ssl_certificate   cert/1531309350240.pem;
    ssl_certificate_key  cert/1531309350240.key;

    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    location / {
        root html;
        index index.html index.htm;
    }
}
</code></pre><h3 id="location详解"><a href="#location详解" class="headerlink" title="location详解"></a>location详解</h3><ul>
<li><p>匹配规则</p>
<ul>
<li>/        ：全匹配</li>
<li>~     ：波浪线表示执行一个正则匹配，区分大小写</li>
<li>~*    :表示执行一个正则匹配，不区分大小写</li>
<li>^~    :^~表示普通字符匹配，如果该选项匹配，只匹配该选项，不匹配别的选项，一般用来匹配目录</li>
<li>=     :进行普通字符精确匹配</li>
<li>@     :”@” 定义一个命名的 location，使用在内部定向时，例如：error_page, try_files</li>
</ul>
</li>
<li><p>参数</p>
<ul>
<li>index ：定义索引页</li>
<li><p>root ：指定虚拟根目录</p>
<p>  配置段：http、server、location、if</p>
<pre><code>#在地址栏输入xxx.com/hello.html时，服务器到/var/html目录下找hello.html文件
location / {
    root /var/html/；
}

#在地址栏输入xxx.com/html/hello.html时，服务器到/var/html目录下找hello.html文件
location /html/ {
    root /var/；
}
</code></pre></li>
<li><p>alias ：定义一个目录别名</p>
<p>  配置段：location</p>
<pre><code>#在地址栏输入xxx.com/var/hello.html时，服务器到/var目录下找hello.html文件
location /html/ {
    alias /var/；
}
</code></pre><p>  注意这里不会再/html/下找文件，因为alias会把location后的目录丢掉，alias值定义一个目录的别名</p>
</li>
</ul>
</li>
</ul>
<h1 id="错误排查"><a href="#错误排查" class="headerlink" title="错误排查"></a>错误排查</h1><ul>
<li><p>找不到目录（403）</p>
<p>  这种错误类型一般都是根目录找不到</p>
<ol>
<li>首先检查配置文件中的root，location确定配置目录无误</li>
<li>找到需要访问的文件，确认文件名和后缀无误</li>
<li>查看配置文件中server_name参数，如果实在地址栏中访问ip或域名，则把localhost改成相应的ip或域名</li>
<li>当根目录设置成/root时，只有root用户可以找到，但是配置文件第一行默认是写user nginx 所以，需要把它改成user root </li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://dmonster.top/2018/07/04/nginx搭建web服务器/" data-id="cjy83156u001wmktlgnkdmzak" class="article-share-link" data-share="baidu" data-title="nginx搭建web服务器">分享到</a>
      

      
        <a href="http://dmonster.top/2018/07/04/nginx搭建web服务器/#ds-thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>
</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python3/">python3</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/zabbix/">zabbix</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a><span class="category-list-count">11</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCIE/">CCIE</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCNA/">CCNA</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCNP/">CCNP</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小玩意/">小玩意</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/笔记/">笔记</a><span class="tag-list-count">20</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/11/08/zabbix搭建/">zabbix搭建</a>
          </li>
        
          <li>
            <a href="/2018/09/20/事务的隔离级别及脏读，幻读/">事务的隔离级别及脏读，幻读</a>
          </li>
        
          <li>
            <a href="/2018/08/10/linux内核相关/">linux内核相关</a>
          </li>
        
          <li>
            <a href="/2018/08/07/mysql-binlog日志/">mysql binlog日志</a>
          </li>
        
          <li>
            <a href="/2018/08/07/mysql存储引擎/">mysql存储引擎</a>
          </li>
        
      </ul>
    </div>
  </div>

  
     
	<div class="widget-wrap"> 
		<h3 class="widget-title">Weibo show</h3> 
		<div class="widget-weibo"> 
			<iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=5&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=5753916666&verifier=c645597d&dpc=1"></iframe>
		</div> 
	</div> 

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 dmonster<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/sitemap.xml" class="mobile-nav-link">sitemap</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"reqianduan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/script.js"></script>

</div>
</body>
</html>
